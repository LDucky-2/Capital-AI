<?php
include 'auth_session.php';
checkLogin();
// Restrict Access: Investors cannot view predictions
if (hasRole('Investor')) {
    header("Location: index.php");
    exit();
}
include 'Database.php';

<<<<<<< Updated upstream:Predictions.html
    <div class="navbar">
        <ul>
            <li><a href="Audits.html">Audit Reports</a></li>
            <li><a href="Company_Database.html">Company Database</a></li>
            <li><a href="Employee_Database.html">Employee Database</a></li>
            <li><a href="Frauds.html">Fraud Alerts</a></li>
            <li><a href="Investor_Database.html">Investor Database</a></li>
            <li><a href="Logs.html">All Logs</a></li>
            <li><a href="My_Company.html">My Company</a></li>
            <li><a href="My_Institution.html">My Institution</a></li>
            <li><a href="My_Stocks.html">My Stocks</a></li>
            <li><a href="Predictions.html" class="active">Stock Prediction</a></li>
            <li><a href="Stock_Transactions_and_Trades.html">Stock Transactions and Trades Database</a></li>
            <li><a href="Stocks.html">All Stocks</a></li>
            <li><a href="Institution_Database.html">Institutions</a></li>
            <!-- <li><a href="Employee_Database.html">Employee Database</a></li> -->
            <!-- <li><a href="Employee_Database.html">Employee Database</a></li>  -->
            <!-- <li><a href="Log_in.html">Log In Page</a></li> -->
        </ul>
    </div>
=======
// Prediction_T joined with Stock_T (for Price) and Company Name
$sql = "
    SELECT 
        p.Stock_ID,
        u.Name as Company_Name,
        s.Current_Price,
        p.Predicted_Price,
        p.Confidence_Score,
        p.Model_Version,
        p.Accuracy_Score
    FROM Prediction_T p
    JOIN Stock_T s ON p.Stock_ID = s.Stock_ID
    JOIN Company_T c ON s.Company_User_ID = c.Company_User_ID
    JOIN User_T u ON c.Company_User_ID = u.User_ID
    ORDER BY p.Timestamp DESC
";
$Predictions = $conn->query($sql);
?>
>>>>>>> Stashed changes:Predictions.php

<?php include 'includes/header.php'; ?>
<?php include 'includes/sidebar.php'; ?>

<div class="page-header">
    <h2>Stock Predictions</h2>
</div>

<div class="data-table-scroll-wrapper">
    <table class="data-table">
        <thead>
            <tr>
                <th>Stock ID</th>
                <th>Company Name</th>
                <th>Current Price</th>
                <th>Predicted Price</th>
                <th>Confidence</th>
                <th>Model</th>
                <th>Accuracy</th>
            </tr>
        </thead>
        <tbody>
            <?php
            if ($Predictions && $Predictions->num_rows > 0) {
                while($row = $Predictions->fetch_assoc()) {
                    echo "<tr>";
                    echo "<td>" . htmlspecialchars($row['Stock_ID']) . "</td>";
                    echo "<td>" . htmlspecialchars($row['Company_Name']) . "</td>";
                    echo "<td>$" . htmlspecialchars($row['Current_Price']) . "</td>";
                    echo "<td>$" . htmlspecialchars($row['Predicted_Price']) . "</td>";
                    echo "<td>" . htmlspecialchars($row['Confidence_Score']) . "</td>";
                    echo "<td>" . htmlspecialchars($row['Model_Version']) . "</td>";
                    echo "<td>" . htmlspecialchars($row['Accuracy_Score']) . "</td>";
                    echo "</tr>";
                }
            } else {
                echo "<tr><td colspan='7' style='text-align:center;'>No predictions found.</td></tr>";
            }
            ?>
        </tbody>
    </table>
</div>

<?php include 'includes/footer.php'; ?>